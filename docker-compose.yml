version: "3.9"
services:
  dev:
    container_name: dev
    image: ubuntu:latest
    command: sleep infinity

  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    dns: 127.0.0.1
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "67:67/udp"
      - "8081:80/tcp"
      - "4433:443/tcp"
    environment:
      TZ: 'Europe/Berlin'
    volumes:
      - './pihole/etc-pihole/:/etc/pihole/'
      - './pihole/etc-dnsmasq.d/:/etc/dnsmasq.d/'
    restart: unless-stopped
    mem_limit: 1000m

  ## Prometheus
  prometheus:
    container_name: prometheus
    image: prom/prometheus:latest
    dns: 127.0.0.1
    ports:
      - "9090:9090/tcp"
    volumes:
      - './prometheus/prometheus.yml:/etc/prometheus/prometheus.yml'
    restart: unless-stopped
    mem_limit: 1000m

  satisfactory:
   container_name: 'satisfactory'
   hostname: 'satisfactory-server'
   image: 'wolveix/satisfactory-server:latest'
   ports:
    - '7777:7777/udp'
    - '15000:15000/udp'
    - '15777:15777/udp'
   environment:
    - DEBUG=false
    - MAXPLAYERS=8
    - PGID=1000
    - PUID=1000
    - SKIPUPDATE=false
    - STEAMBETA=true
   restart: unless-stopped
   volumes:
    - '/home/rojo/dev/satisfactory:/config'

  cloudflare-ddns:
    image: timothyjmiller/cloudflare-ddns:latest
    container_name: cloudflare-ddns
    security_opt:
      - no-new-privileges:true
    network_mode: "host"
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - ./cloudflare-ddns/config.json:/config.json
    restart: unless-stopped

  discord-musicbot:
    build: ./discord-musicbot
    image: discord-musicbot:latest
    container_name: discord-musicbot
    restart: unless-stopped
    ports:
      - '80:3000/tcp'
    networks:
      - lavalink-net
    # depends_on:
    #   - lavalink
    volumes:
      - ./discord-musicbot/botconfig.js:/usr/src/app/botconfig.js:ro

  lavalink:
    image: fredboat/lavalink:dev
    container_name: music-lavalink
    hostname: lavalink
    restart: unless-stopped
    networks:
      - lavalink-net
    volumes:
      - ./application.yml:/opt/Lavalink/application.yml:ro

networks:
  lavalink-net:


# ## Elasticsearh
  # es01:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2
  #   container_name: es01
  #   environment:
  #     - node.name=es01
  #     - cluster.name=es-docker-cluster
  #     - discovery.seed_hosts=es02,es03
  #     - cluster.initial_master_nodes=es01,es02,es03
  #     - bootstrap.memory_lock=true
  #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  #   ulimits:
  #     memlock:
  #       soft: -1
  #       hard: -1
  #   volumes:
  #     - data01:/usr/share/elasticsearch/data
  #   ports:
  #     - 9200:9200
  #   networks:
  #     - elastic
  # es02:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2
  #   container_name: es02
  #   environment:
  #     - node.name=es02
  #     - cluster.name=es-docker-cluster
  #     - discovery.seed_hosts=es01,es03
  #     - cluster.initial_master_nodes=es01,es02,es03
  #     - bootstrap.memory_lock=true
  #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  #   ulimits:
  #     memlock:
  #       soft: -1
  #       hard: -1
  #   volumes:
  #     - data02:/usr/share/elasticsearch/data
  #   networks:
  #     - elastic
  # es03:
  #   image: docker.elastic.co/elasticsearch/elasticsearch:7.11.2
  #   container_name: es03
  #   environment:
  #     - node.name=es03
  #     - cluster.name=es-docker-cluster
  #     - discovery.seed_hosts=es01,es02
  #     - cluster.initial_master_nodes=es01,es02,es03
  #     - bootstrap.memory_lock=true
  #     - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  #   ulimits:
  #     memlock:
  #       soft: -1
  #       hard: -1
  #   volumes:
  #     - data03:/usr/share/elasticsearch/data
  #   networks:
  #     - elastic